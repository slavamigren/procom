# Тестовое задание для Прокомплаенс


Проект разворачивается в docker одной командой
> docker-compose up

После чего сервисом можно пользоваться.

### Реализованы следующие эндпоинты (для простоты используем localhost, все примеры буду описывать для тестирования через Postman):

1) Регистрация пользователя (разделение прав доступа не сделал, но могу добавить, если нужно)
    > http://127.0.0.1:8000/users/create/
    
    для регистрации необходимо отправить POST запрос c почтой и паролем (в postman закладка Body, типа данных raw, формат json):
    
        {
            "email": "test@test.ru",
            "password": "12345"
        }


2) После регистрации необходимо получить токен:
    > http://127.0.0.1:8000/users/token/

    необходимо отправить POST запрос c почтой и паролем (в postman закладка Body, типа данных raw, формат json), пример:

        {
            "email": "test@test.ru",
            "password": "12345"
        }

    получите токены, использовать необходимо "access". Пример:

        {
            "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTY5NTkxMDgxNywiaWF0IjoxNjk0MTgyODE3LCJqdGkiOiIxMTg1NDkwYTk2NDc0NzgxOWNjY2Q1Y2QyZjEwMDg2NiIsInVzZXJfaWQiOjF9.14YxjDgJsVvKwAlH_5M32AMHr0G_zfCHlhIqcP17cZI",
            "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjk1MDQ2ODE3LCJpYXQiOjE2OTQxODI4MTcsImp0aSI6IjRmYzk4MmVlYThlNjQwYmM5ZGIwYTk5OGY2ZTI5N2YyIiwidXNlcl9pZCI6MX0.SrJpFh6-puybtOlgYvQTfU9wqnyYujmqNw7wdNWwSYI"
        }

### Далее во всех запросах необходимо на вкладке "Headers" поле "Key" выбирать Authorization, в поле "Value" добавить значение "Bearer <ваш токен>"


3) Эндпоинт для загрузки файлов:
    > http://127.0.0.1:8000/csvserv/upload/

    для загрузки необходимо в POST запросе указать файл: на вкладке "Body" выбираете тип данных "form-data", в поле "Key" выбираете "file" и в поле Value выбираете файл для загрузки.
    
    Возвращает id файла в базе данных.
    
    В проект вложен датасет с Kaggle с базой фильмов (test_file.csv - используется в тестах), можете воспользоваться этим файлом для тестирования.


4) Эндпоинт для просмотра всех доступных файлов: 
    > http://127.0.0.1:8000/csvserv/list/

    запрос GET без аргументов.
    Выводит доступные файлы и список полей в каждом файле


5) Эндпоинт для удаления файла:
    > http://127.0.0.1:8000/csvserv/delete/<id>/

    запрос DELETE, вместо id в адресе указываете id удаляемого файла (получили его после загрузки или можете посмотреть в листе всех файлов)


6) Эндпоинт для просмотра информации в файле:
    > http://127.0.0.1:8000/csvserv/detail/<id>/

    GET запрос, вместо id в адресе указываете id просматриваемого файла (получили его после загрузки или можете посмотреть в листе всех файлов)
    
    Так же, если хотите отфильтровать или отсортировать, необходимо отправить (контекст) параметры для фильтрации и сортировки, для этого выбираете на вкладке "Body", тип данных raw, формат json. Пример:

        {
            "filter":{
                "Genre": "Drama",
                "Meta_score": "77"
            }
            "sort": {
                "Released_Year": false,
                "IMDB_Rating": true
            },
        }

    по ключу 'sort' отправляете название полей для сортировки и признак реверсивности - true или false; полей для сортировки можете указывать любое количество
    
    по ключу 'filter' отправляете названия полей для фильтрации и значения для фильтрации; полей для фильтрации можете указывать любое количество
    
    сначала выполняется фильтрация, потом сортировка, всё в порядке указания полей.

    В примере сначала фильмы фильтруются по Genre, потом фильтруются по Meta_score, потом сортируются прямо по Released_Year и реверсивно по IMDB_Rating.


7) Документация доступна по адресам:
    > http://127.0.0.1:8000/docs/

    > http://127.0.0.1:8000/redoc/


Покрытие тестами 94%, отчёт в файле coverage.txt в корне проекта. Так же в тестах содержатся примеры работы с API не через Postman.

В коде присутствует защита от указания в сортировке и фильтрации несуществующих полей, а так же от работы с файлами не формата csv.